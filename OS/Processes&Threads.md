# 프로세스와 스레드

## 프로세스

- 프로세스는 실행중인 프로그램으로 디스크로부터 메모리에 적재되어 CPU의 할당을 받을 수 있는 것을 말한다.
- 프로세스는 함수의 매개변수, 복귀주소와 로컬 변수와 같은 임시 자료를 갖는 프로세스 스택과 전역 변수를 수록하는 데이터 섹션을 포함한다. 또한 프로세스는 프로세스 실행중에 동적으로 할당되는 메모리인 힙을 포함한다.
- 즉 프로세스는 코드,데이터, 힙 , 스택 영역으로 나뉜다.

<br><br>

## PCB (프로세스 제어 블록)

PCB는 특정 프로세스에 대한 중요한 정보를 저장하고 있는 운영체제의 자료구조이다.

운영체제는 프로세스를 관리하기 위해 프로세스의 생성과 동시에 고유한 PCB를 생성한다.

즉, 커널에 있는 PCB는 프로세스의 갯수만큼 PCB가 생성되어 있다.

PCB 에 저장되는 정보 
* 프로세스 식별자 (PID)
* 프로세스 상태
* 프로그램 카운터 (PC)
* CPU 레지스터 
* CPU 스케쥴링 정보
* 메모리관리 정보
* 입출력 상태 정보
* 어카운팅 정보

<br><br>

## 스레드

스레드는 프로세스의 실행 단위라고 할수 있다.   
한 프로세스 내에서 동작되는 여러 실행 흐름으로 프로세스 내의 힙영역, 데이터영역은 쓰레드간 공유된다.   
하나의 프로세스를 다수의 실행 단위로 구분하여 자원을 공유하고 각 스레드가 하나의 작업을 처리하는 것을 멀티스레딩이라고 하며,   
이 경우 각 스레드는 독립적입 작업을 수행해야 하기 때문에 각자의 스택과 PC레지스터 값을 가지고 있다.  

<br><br>

## 멀티스레드

- 프로세스를 이용하여 동시에 처리하던 일을 스레드로 구현할 경우 메모리 공간과 시스템 자원 소모가 줄어들게 된다. 스레드 간의 통신이 필요한 경우에도 별도의 자원을 이용하는 것이 아니라 전역 변수의 공간 또는 동적으로 할당된 공간인 Heap 영역을 이용하여 데이터를 주고받을 수 있다.
- 그렇기 때문에 프로세스 간 통신 방법에 비해 스레드 간의 통신 방법이 훨씬 간단하다. 심지어 스레드의 문맥교환은 프로세스의 문맥교환과는 달리 캐시 메모리를 비울 필요가 없기 떄문에 더 빠르다.
- 따라서 시스템의 처리량이 향상되고 자원 소모가 줄어들며 자연스럽게 프로그램의 응답 시간이 단축된다.

<br>

문제점

서로 다른 스레드가 데이터와 힙 영역을 공유하기 떄문에 어떤 스레드가 다른 스레드에서 사용중인 변수나 자료구조에 접근하여 엉뚱한 값을 읽어오거나 수정할수 있다. 그렇기 때문에 멀티스레딩 환경에서 동기화 작업이 필요하다. 동기화를 통해 작업 처리 순서를 컨트롤 하고 공유자원에 대한 접근을 컨트롤 하는 것이다. 

하지만 이로 인해 병목현상이 발생하여 성능이 저하될 가능성이 높다. 그러므로 과도한 락으로 인한 병목 현상을 줄여야한다. 

<br><br>

## 멀티프로세스와 멀티스레드

멀티 스레드는 멀티 프로세스보다 작은 메모리 공간을 차지하고 문맥 교환이 빠르다는 장점이 있지만, 오류로 인해 하나의 스레드가 종료되면 전체 스레드가 종료될 수 있다는점과 동기화 문제를 안고 있다.  
반면 멀티 프로세스 방식은 하나의 프로세스가 죽더라도 다른 프로세스에는 영향을 끼치지 않고 정상적으로 수행된다는 장점이 있지만,  
멀티 스레드보다 많은 메모리 공간과 CPU 시간을 차지한다는 단점이 존재한다.

<br><br>

## IPC

* IPC란 하나의 컴퓨터 안에서 실행 중인 서로 다른 프로세스 간에 발생하는 통신을 말한다.

* IPC는 프로세스들간의 통신과 동기화를 이루기 위한 메커니즘을 의미한다.

* IPC 방식에는 메시지 전달 방식, 공유메모리 방식이 있으며 두 방식의 차이는 프로세스 사이에 공유 데이터를 사용하는가에 있다.

<br><br>

- 메시지 전달(message passing)

    프로세스간에 메시지를 주고받으면서 통신하는 방식이다. 이떄, 두 프로세스의 주소 공간이 다르므로 메시지 전달을 직접할수 없으니 커널이 그 역할을 하게 된다.

    메시지 통신을 하는 시스템은 커널에 의해 send 와 receive 라는 두가지 연산을 제공받게 된다.

    메시지를 프로세스끼리 직접 주고받을 수 있다면 원하지 않는 메시지를 전달해 다른 프로세스에 악영향을 미칠수 있으므로  
    운영체제는 메시지를 주고받는 연산을 특권명령으로 규정해 커널을 통해서만 가능하도록 하고 있다.

    통신하기를 원하는 두 프로세스는 커뮤니케이션 링크를 생성한후 메시지를 주고받게 되며,

    커뮤니케이션 링크의 구현방법은 물리적인 방법과 논리적인 방법이 있다.

<br><br>

- 공유메모리(shared memory)

    프로세스들이 주소 공간의 일부를 공유한다. 

    원칙적으로 자신의 주소 공간에 특정한 내용을 쓸경우 이는 자신만 볼 수 있으나, 운영체제는 공유메모리를 사용하는 시스템콜을 지원해, 서로 다른 프로세스들이 그들의 주소 공간 중 일부를 공유할수 있도록 한다.

    공유메모리 방식은 프로세스간의 통신을 수월하게 만드는 인터페이스를 제공하지만 서로의 데이터에 일관성 문제가 유발될 수 있다. 그렇기 떄문에 프로세스들끼리 동기화 문제를 책임져야한다.

<br><br>

## 크롬의 탭 하나하나는 프로세스일까? 스레드일까?

탭과 탭끼리 서로 자원을 공유하진 않아 보인다.

1. 탭하나가 오류가 생겼다고 해서 다른탭에 영향을 주지 않는다.
2. 크롬을 종료하면 모든 탭과 같이 종료된다.
3. 크롬의 탭 하나하나에 PID가 존재한다.

→ 2,4 번을 통해 크롬은 프로세스임을 알수 있다. 

1번은 멀티프로세스또한 IPC를 통해 통신이 가능하므로 고려해야할 사항이 아니다. 

(물론 공유를 자주하면서 속도가 필요한다면 쓰레드를 사용하는게 좋다)

3번은 크롬을 종료한다는게 부모프로세스이기 떄문에 부모프로세스가 종료되면서 자식프로세스들을 전부다 종료시키는 것이다.
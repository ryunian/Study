# 인터럽트

- 주변장치 및 입출력 장치는 CPU나 메모리와 달리 인터럽트라는 메커니즘을 통해 관리가 이루어진다.주변장치들은 CPU의 서비스가 필요한 경우에 신호를 발생시켜 서비스를 요청하는데 이때 발생시키는 신호를 인터럽트라고 한다.

- 인터럽트는 하드웨어 인터럽트와 소프트웨어 인터럽트로 나뉘며,하드웨어 인터럽트는 컨트롤러 등 하드웨어 장치가 CPU의 인터럽트 라인을 세팅하며 소프트웨어 인터럽트는 소프트웨어가 그 일을 수행한다 (인터럽트라고 하면 보통 하드웨어 인터럽트를 의미한다)


<br><br>

### **소프트웨어 인터럽트**

트랩(trap)이라는 용어로 주로 불리며, 소프트웨어 인터럽트의 예로는 예외상황(exception)과 시스템콜(System call) 이 있다.

<br>

- 예외상황 : 사용자 프로그램이 0으로 나누는 연산 등 비정상적인 작업을 시도, Page Fault가 발생하거나 자신의 메모리 영역 바깥에 접근하려는 시도 등 권한이 없는 작업을 시도할 떄 이에 대한 처리를 위해 발생시키는 인터럽트 이다.

<br>

- 시스템 콜(System call)일반적인 프로그램은 사용자 모드에서 실행되므로 커널 모드에 재한 직접적인 접근이 불가능하기 때문에커널에 요청하여 커널모드에서 처리하고 그 결과를 사용자모드의 프로그램에 전달하는 것

<br>

- 시스템콜의 과정
1. 사용자 프로그램이 CPU에서 명령을 수행하던 중 디스크의 파일을 읽어야할 경우 발생
2. 시스템 콜로 커널의 함수를 호출한다.
3. 입출력 함수의 호출이 자신의 주소 공간에서 이루어질수 없기 때문에 사용자 프로그램을 잠시 멈춘 후 CPU의 제어권을 운영체제로 이양
4. 설정된 인터럽트 라인에 의해 이번에 발생한 인터럽트가 입출력임을 인지한다.
5. 서비스 루틴으로 이동해 입출력 작업을 수행 (컨트롤러, 여기선 디스크 컨트롤러)
6. 사용자 프로그램은 봉쇄상태가 된다 (봉쇄상태가 된 사용자 프로그램은 중기스케줄러에 의해 스왑아웃 된다 (스왑아웃 0순위))
7. CPU의 제어권은 다른 프로세스에게 이양된다 (효율적인 자원 활용을 위해)
8. 입출력 작업이 완료되면 디스크 컨트롤러가 CPU에게 인터럽트(하드웨어 인터럽트)를 발생시켜 입출력 작업이 완료되었음을 알린다
9. .CPU는 사용자 프로세스의 수행을 잠시 멈추고 인터럽트 처리루틴으로 그 제어권을 넘긴다.
10. 디스크로부터 로컬버퍼로 읽어온 내용을 메모리에 복사한뒤, 이전에 멈췄던 프로세스에게 제어권을 넘겨준다.
11. 입출력된 프로세스는 레디 큐에 삽입된다.

<br><br><br>

### DMA (Direct Memory Access)

컨트롤러가 CPU에게 인터럽트를 발생시키면 CPU는 컴트롤러의 로컬버퍼와 메모리 사이에서 데이터를 옮기는 일을 하게 된다.

모든 메모리 접근 연산이 CPU에 의해서만 이루어질 경우 입출력 장치가 메모리 접근을 원할 때마다 인터럽트에 의해 CPU의 업무가 방해를 받게 되어 CPU 효율성이 떨어진다.

이러한 것을 해결하기 위해, CPU 이외에 메모리 접근이 가능한 장치를 하나더 두는 경우가 많은데 이와 같은 장치를 DMA(Direct Memory Access) 라고 부른다

DMA는 일종의 컨트롤러로서, CPU가 입출력 장치들의 메모리 접근을 요청에 의해 자주 인터럽트 당하는 것을 막아주는 역할을 한다.

DMA는 로컬버퍼에서 메모리로 읽어오는 작업을 DMA가 대행함으로써 CPU는 원래 하던 작업을 멈추고 인터럽트를 처리할 필요가 없어진다.
# OSI 7계층

> OSI 7 계층은 네트워크 프로토콜이 통신하는 구조를 7개의 계층으로 분리하여 각 계층간 신호 작동하는 방식을 정해놓은 것이다. ( ISO(국제표준화기구) 1984년 발표)


1계층 : 물리계층 (Physical Layer)

2계층 : 데이터링크 계층 (Datalink Layer)

3계층 : 네트워크 계층 (Network Layer)

4계층 : 전송 계층 (Transport Layer)

5계층 : 세션 계층 (Session layer)

6계층 : 표현 계층 (Presentation Layer)

7계층 : 응용 계층 (Application Layer)


<br><br>

<img src="https://github.com/ryunian/Study/blob/master/image/OSI7Layer.png?raw=true" width="700px" height="500px">


<br><br>

- 컴퓨터 통신 구조의 모델과 앞으로 개발된 프로토콜의 표준적인 뼈대를 제공하기 위해 개발된  "참조 모델" 이다.

- 모든 통신 시스템이 7계층을 다 가지고 있는 것은 아니며, 모든 하드웨어 및 소프트웨어는 하나의 계층만으로 구현될 수도 있고 여러 개의 계층에 걸쳐 구현될 수 있다.

- 7단계 중 특정한 곳에서 이상이 생기면 다른 단계의 장비 및 소프트웨어를 건드리지 않고도 이상이 생긴 단계만 고칠 수 있다.

    즉, 계층간에 독립된 기능을 제공하며, 인전합 계층 간에만 의존하게 된다.

- 실제 인터넷에서 사용되는 TCP/IP 는 OSI 참조 모델을 기반으로 상업적이고 실무적으로 이용될 수 있도록 단순화 된것이다.

<br><br><br><br>

# 1. 응용 계층 (Application Layer)

> OSI 7계층의 최상위에 있는 계층이며 응용 프로세스와 직접 관계하여 일반적인 응용 서비스를 수행한다.  
> 일반적인 응용 서비스는 관련된 응용 프로세스들 사이의 전환을 제공한다
>
> 즉, 여러 하위 통신 프로토콜 개체에 대하여 사용 관점의 사용자 인터페이스를 제공한다.
>
> 프로토콜 :  HTTP , SMTP, IMAP, POP3, FTP, DNS, Telnet  
> 단위 : 데이터 (Data)


- 어플리케이션 계층 프로토콜은 여러 종단 시스템에 분산되어 있어서,   
    한 종단 시스템에 있는 어플리케이션이 다른 종단 시스템에 있는 어플리케이션과 정보 패킷을 교환하는 데 이 프로토콜을 사용한다.
    
- 어플리케이션 계층에서의 이 정보 패킷을 메시지(message)라고 부른다.

<br><br>

### 1.1 HTTP (HyperText Transfer Protocol)

- 웹 상에서 웹 서버 및 웹브라우저 상호 간의 데이터 전송을 위한 응용계층 프로토콜
- 처음에는 WWW 상의 하이퍼텍스트 형태의 문서를 전달하는데 사용되었지만,  
    현재는 이미지, 비디오 등 거의 모든 형식의 데이터 전송가능
- 클라이언트 / 서버 모델로 동작

<br>

특징)
1. 전송계층 프로토콜은 TCP를 사용한다.
2. 포트 번호는 80포트를 사용한다. (HTTPS의 경우 443)
3. 비연결 (Connectionless)
4. 무상태 (Stateless)

<br><br>

### 1.2 SMTP

- 인터넷 전자메일을 위한 주요 어플리케이션 계층 프로토콜이다.
- SMTP는 메일을 송신자의 메일 서버로부터 수신자의 메일 서버로 전송하는 데 TCP의 신뢰적인 데이터 전송 서비스를 이용한다.
- HTTP가 풀(pull) 프로토콜이라면 SMTP는 푸시(push) 프로토콜이다.
- 포트번호는 25포트를 사용한다.

~~HTTP보다 오래되었다~~

<br><br>

### 1.3 POP3 / IMAP

- 메일 접속 프로콜로써 수신자의 메일 서버로부터 수신자의 사용자 에이전트에게 메일을 전송하는데 사용된다.
- POP는 원격 서버에 접속하여 이메일을 가져온 후, 서버에서 이메일을 삭제한다.
- IMAP은 중앙 서버에서 동기화가 이루어지기 때문에 모든 장치에서 동일한 이메일을 볼 수 있다는 장점이 있다.  
    메일을 가져와도 서버에 메일이 그대로 남아 있으며 서버 트래픽이 많이 쓰인다는 단점이 있다.

<br><br>

### 1.4 DNS
- HostName이란, 네트워크에 연결된 장치들에게 부여되는 각각의 고유한 이름이며,  
    호스트 이름은 도메인 이름의 한 가지 특수한 유형입니다.  
    도메인 이름 중에서 IP주소를 설정할 수 있는 이름이 호스트 이름입니다. 호스트 이름은 도메인 이름의 유형 중 일부분입니다.
    
- 이런 HostName은 기억하기 쉽다는 장점이 있으나, 라우터가 처리하는 데 어려움이 있다.  
    그렇기 때문에 IP 주소로 변환을 해줘야하는데 이떄, DNS를 사용한다.

- UDP를 사용하며, DNS 서버는 계층 구조로 이루어져 있으며,  
    재귀적질의(recursive query)와 반복적 질의(iterative query)를 사용하여 매핑한다.

<br><br><br><br>

# 2. 표현 계층  (Presentation Layer)

> 통신하는 어플리케이션들이 교환되는 데이터의 의미를 해석하도록 하는 서비스를 제공하는 계층
> 
> 컴퓨터들마다 포맷이 다를 수 있기 때문에, 이 계층을 통해서 데이터가 표현/저장되는 내부 포맷을 걱정하지 않아도 되게 해준다.
> 
> 단위 : 데이터(Data)

ex) EBCDIC로 인코딩된 문서 파일을 ASCII로 디코딩. MIME 인코딩

### 기능)

1. 번역 : 수신자에서 온 데이터를 해석하기 위한 응용계층 데이터 부호화, 변화
2. 압축 : 수신자에서 데이터의 압출을 풀수 있는 방식으로 된 데이터 압축
3. 암호화 : 데이터의 암호화와 복호화

<br><br><br><br>

# 3. 세션 계층 (Session Layer)

> 양 끝단의 응용 프로세스가 통신을 관리하기 위한 방법을 제공한다.

이 계층은 TCP/IP 세션을 만들고 없애는 책임을 진다.

통신하는 사용자들을 동기화하고 오류복구 명령들을 일괄적으로 다룬다.

단위 : 데이터(Data) or 메세지(Message)

ex) socket

<br><br><br><br>

# 4. 전송 계층 (Transport Layer)

> 클라이언트와 서버 간에 어플리케이션 계층 메시지를 전송하는 서비스를 제공한다. 
> 
> 포로토콜 : TCP, UDP  
> 단위 : 세그먼트 , 데이터그램  
> 장비 : L4 Switch

- TCP와 UDP의 가장 기본적인 기능은 종단 시스템 사이의 IP 전달 서비스를  
    종단시스템에서 동작하는 두 프로세스 간의 전달 서비스로 확장하는 것이다.

- "호스트-대-호스트 전달"을 "프로세스-대-프로세스 전달"로 확장하는 것을 [트랜스포트 다중화]와 [역다중화]라고 부른다.

<br><br>

### 4.1 TCP

> 신뢰성을 보장하는 연결형 프로토콜이며, TCP는 어플리케이션 프로세스가 데이터를 다른 프로세스에게 보내기 전에, 
> 
> 두 프로세스가 서로 "3-way handshake"를 통해서 연결을 하며,   
> 연결을 끊기 위해선 "4-way handshake"를 통해서 연결을 해제한다.  
> 
> 연결지향형, 전이중, 점대점이라는 특징을 가지며, 흐름제어와 혼잡에러를 제공해준다.  
> 단위 : 세그먼트

- TCP는 TCP 헤더와 클라이언트 데이터를 하나로 만들어 TCP 세그먼트를 형성한다.  
    세그먼트는 네트워크 계층에 전달되며, 네트워크 계층 IP 데이터그램 안에 각각 캡슐화 된다.

- TCP는 IP의 비신뢰적인 "최선형(best-effort)" 서비스에서 신뢰적인 데이터 전달 서비스를 제공한다.  
    TCP의 신뢰적인 데이터 전달 서비스는 프로세스가 자신의 수신 버퍼로부터 읽은 데이터 스트림이 손상되지 않았으며 송신이나 중복이 없다는 것과 순서가 유지된다는 것을 보장한다.

    
    흐름제어
    1. 수신하는 어플리케이션이 읽는 속도와 송신자가 전송하는 속도를 일치시키는 서비스이다.
    2. TCP는 송신자가 수신 윈도우라는 변수를 유지하여 흐름제어를 제공한다.
    3. 수신 윈도우는 수신 측에서 가용한 버퍼 공간이 얼마나 되는지를 송신자에게 알려 주는데 사용된다.
    4. TCP는 전이중이므로 각 측의 송신자는 별개의 수신 윈도우를 유지한다.


    혼잡제어 
    1. IP 계층이 네트워크 혼잡에 관해서 종단 시스템에게 어떠한 직접적인 피드백도 제공하지 않는다.
    2. TCP는 네트워크 지원 혼잡제어보다는 종단간의 혼잡제어를 사용해야한다.
    3. TCP가 취한 접근방법은 네트워크 혼잡에 따라 연결에 트래픽을 보내는 전송률을 각 송신자가 제한하도록 하는 것이다.

<br><br>

### 4.2 UDP

> 신뢰성을 보장하지 않는 비연결형 프로토콜로 데이터를 데이터그램 단위로 처리한다.
> 
> 일대일, 일대다, 다대다 통신을 한다.  
> 단위 : 데이터그램

- UDP는 트랜스포트 계층 프로토콜이 할 수 있는 최소 기능으로 동작한다.  
    UDP는 다중화/역다중화 기능과 간단한 오류 검사기능을 제외하면 IP에 아무것도 추가하지 않는다.
    
- UDP는 어플리케이션 프로세스로부터 메시지를 가져와서 다중화/역다중화 서비스에 대한 출발지 포트 번호 필드와 목적지 포트 번호 필드를 첨부하고 다른 두 필드들을 추가한 후에 최종 데이터그램을 네트워크 계층으로 넘겨준다.

- UDP는 세그먼트를 송신하기 전에 송신 트랜스포트 계층 개체들과 수신 트랜스포트 계층 개체들 사이에 핸드셰이크를 사용하지 않기 때문에 비연결형이라고 한다.


        Q. 어플리케이션 계층 프로토콜 (HTTP, SMTP, Telnet, FTP, DNS, 통상 독점프로토콜(스트리밍 멀티미디어) 들은
        하위 트랜스포트 프로토콜로 무엇을 사용하는가? 그리고 UDP를 쓴다면 그 이유가 무엇인가?
        
        웹 - HTTP - TCP
        전자메일 - SMTP - TCP
        원격터미널 접속 - Telnet - TCP
        파일전송 - FTP - TCP
        스트리밍 멀티미디어 - 통상 독점 프로토콜 - TCP or UDP
        이름변환 - DNS - UDP
        
        실시간 어플리케이션은 TCP 혼잡제어가 나쁜 영향을 미치기 때문이다.
        그러나 패킷 손실률이 낮고, 보안적인 이유로 일부 조직에선 TCP를 이용한다.

<br><br><br><br>

# 5. 네트워크 계층 (Network Layer)

> 한 호스트에서 다른 호스트로 데이터그램(datagram) 을 라우팅하는 책임을 진다.
> 
> 대표적으로 IP 프로토콜이 있으며, IP 데이터그램의 필드를 정의하며 종단 시스템과 라우터가 이 필드에 어떻게 동작하는지를 정의한다.
> 
> 출발지와 목적지 사이에서 데이터그램이 이동하는 경로를 결정하는 라우팅 프로토콜을 포함한다.
> 
> 단위 : 패킷 (Packet)  
> 프로토콜 : IP, ARP, ICMP 등  
> 장비 : 라우터 , L3 Switch

<br>

- 네트워크 계층은 네트워크 호스트의 논리 주소 지정(ex : ip 주소 사용)을 확인한다.

- 또한 데이터 스트림을 더 작은 단위로 분할하고 경우에 따라 오류를 감지해 처리한다.

- 그리고 여러 개의 노드를 거칠 때마다 경로를 찾아주는 역할을 하는 계층으로서다양한 길이의 데이터를 네트워크들을 통해 전달하고  
    그 과정에서 전송 계층이 요구하는 서비스 품질을 제공하기 위한 기능적, 절차적 수단을 제공한다.

- 네트워크 계층은 라우팅, 흐름 제어, 세그멘테이션, 오류제어, 인터네트워킹 등을 수행한다. 라우터가 3계층에서 동작하고, 3계층에서 동작하는 스위치도 있다.

<br><br>

    라우팅
        어떤 네트워크 안에서 통신데이터를 짜여진 알고리즘에 의해 최대한 빠르게 보낼 최적의 경로를 선택하는 과정을 라우팅이라고 한다.

    포워딩
        라우터의 입력 포트에서 출력 포트로 패킷을 이동시키는 것을 말한다.

    포워딩 vs 라우팅
        포워딩은 매우 짧은 시간단위를 갖기에 대표적으로 하드웨어에서 실행된다.
    
        라우팅은 네트워크 전반에 걸쳐 출발지에서 목적지까지 데이터그램의 종단간 경로를 결정하는 것이다. 보통 소프트웨어에서 실행된다.
    
    EX) 
    여행자가 서울에서 부산까지 여행한다고 하자. 여행동안 운전자는 많은 교차로를 지난다. 
    
    이때 포워딩은 한 교차로를 지나느 과정이라고 볼수 있다. 
    즉, 차가 하나의 도로에서 교차로로 들어서면 교차로를 떠나 어떤 도로로 들어설지를 결정한다.
    
    라우팅은 서울에서 부산의 여행을 계획하는 과정이라고 볼 수 있다.
    즉, 여행을 시작하기 전에 운전자는 지도를 보면서, 일련의 교차로에 연결된 도로에서 이용 가능한 경로를 선택하는 것이다.

<br>

    네트워크 주소 변환(Network Address Translation, NAT)
    ● IP패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP주소 등을 재기록하면서 라우터를 통해 네트워크 트래픽을 주고 받는 기술을 말합니다.
    
    - 패킷에 변화가 생기기 때문에 IP나 TCP/UDP의 체크섬(checksum)도 다시 계산되어 재기록해야 합니다.
     NAT를 이용하는 이유는 대개 사설 네트워크에 속한 여러 개의 호스트가 하나의 공인IP주소를 사용하여 인터넷에 접속하기 위함입니다.
    
    - 많은 네트워크 관리자들이 NAT를 편리한 기법이라고 보고 널리 사용하고 있으며,  
        NAT가 호스트 간의 통신에 있어서 복잡성을 증가시킬 수 있으므로 네트워크 성능에 영향을 줄 수 있는 것은 당연하다 볼 수 있습니다.
    
    - NAT는 IPv4의 주소 부족 문제를 해결하기 위한 방법으로서 고려되었으며,
        주로 비공인(사설, local) 네트워크 주소를 사용하는 망에서 외부의 공인망(public,예를 들면 인터넷)과의 통신을 위해서 네트워크 주소를 변환하는 것입니다.
    
    - 즉 내부 망에서는 사설IP 주소를 사용하여 통신을 하고,외부망과의 통신시에는 NAT를 거쳐 공인IP 주소로 자동 변환합니다.
    
    
    ● NAT을 사용하는 목적
        첫째, 인터넷의 공인 IP주소를 절약할 수 있다는 점  
        둘째, 인터넷이란 공공망과 연결되는 사용자들의 고유한 사설망을 침입자들로부터 보호할 수 있다는 점

<br>

    DHCP (동적 호스트 구성 프로토콜)
    
    - 네트워크 관리자는 해당 호스트가 네트워크에 접속하고자 할때마다 동일한 IP주소를 바도록 하거나 다른 임시 IP주소를 할당하도록 DHCP를 설정한다.
    
    - DHCP는 호스트 IP 주소의 할당뿐만 아니라, 서브넷 마스크, 첫번째 홉 라우터(디폴트게이트웨이라고 부름) 주소나 로컬 DNS서버 주소같은 추가 정보를 얻게 해준다.
    
    - PC의 수가 많거나 PC 자체 변동사항이 많은 경우 IP 설정이 자동으로 되기 때문에 효율적으로 사용 가능하고,
        IP를 자동으로 할당해주기 때문에 IP 충돌을 막을 수 있습니다.
    
    - 그 외에도 사용하지 않고 꺼놓은 컴퓨터에도 모두 IP를 하나씩 할당해야 하다 보니 IP가 모자라는 기존의 문제도 해결할 수 있다.

<br><br>

# 6. 데이터링크 계층 (Datalink Layer)

> 물리적인 네트워크를 통해 데이터를 전송하는 수단을 제공한다.   
> Mac 주소를 통해 통신, 프레임에 Mac 주소를 부여하고 에러검출, 재전송, 흐름제어를 진행  
> 
> 단위 : 프레임 (Frame)  
> 프로토콜 : 이더넷(Ethernet) , 와이파이 (WIFI) , HDLC, PPP  
> 장비 : 브리지(Bridge), L2 Switch  
> 기능 : 회선제어, 흐름제어, 오류제어 등

- 통신 경로상의 인접한 노드들을 연결하는 통신 채널은 링크(link)라고 한다.   
    데이터그램을 출발지 호스트에서 목적지 호스트로 이동시키기 위해서는 데이터그램을 종단간 경로의 개별 링크로 이동시켜야만 한다.  
    한 링크에서 전송 노드는 데이터그램을 링크 계층 프레임으로 캡슐화해서 링크로 전송한다.  

- 1홉 통신을 담당한다고도 말한다. 홉(hop)은 컴퓨터 네트워크에서 노드에서 다음 노드로 가는 경로를 말한다.  
    1홉 통신이면 한 라우터에서 그 다음 라우터까지의 경로를 말한다.

- 주목적은 물리적인 장치를 식별하는 데 사용할 수 있는 주소 지정 체계를 제공하는 것이다.   
    데이터 링크 계층은 포인트 투 포인트 간의 신뢰성 있는 전송을 보장하기 위한 계층으로 CRC 기반의 오류 제어와 흐름 제어가 필요하다.

- 네트워크 위의 개체들 간 데이터를 전달하고 물리 계층에서 발생할 수 있는 오류를 찾아내고 수정하는 데 필요한 기능적, 절차적 수단을 제공한다.

<br>

### 기능)

1. 프레이밍 (Framing)
물리 계층을 통해 수신한 신호를 조합하여 프레임 단위의 정해진 크기의 데이터 유닛으로 만들어 처리

2. 흐름제어 (Flow Control)
송신 측과 수신 측 간에 데이터를 주고받을 떄, 너무 많거나 너무 적게 데이터를 송수신하지 않도록 데이터 흐름을 적절히 제어

3. 오류 제어 (Error Control)
프레임 전송 시에 발생한 오류를 복원하거나 재전송

4. 접근 제어 (Access Control)
매체 상에 통신 주체 (장치)가 여럿 존재할 떄, 데이터 전송 여부를 결정

5. 동기화 (Synchronization)
프레임 구분자 (특별한 비트패턴)


    MAC 주소
        네트워크 세그먼트의 데이터 링크 계층에서 통신을 위한 네트워크 인터페이스에 할당된 고유 식별자이다.
        IP주소는 변동 가능성이 있으나 MAC주소는 일반적으로 변하지 않는다.

    ARP (Address Resolution Protocol)
        네트워크 계층 주소(IP 주소)와 링크 계층 주소(MAC 주소)가 있으므로 이들 주소 사이에 변환이 필요하다.
        이것을 변환해주는 것을 ARP라고 한다.

<br><br><br><br>

# 7. 물리 계층 (Physical Layer)

> 물리적 장치의 전기적, 전자적 연결에 대한 명세  
> 디지털 데이터를 아날로그적인 전기적 신호로 변환하여 물리적인 전송이 가능케 한다.
> 
> 주소 개념이 없으며 물리적으로 연결된 노드간에 신호를 주고 받는다.
> 
> 단위 : 비트(bit)  
> 장비 : 허브(Hub), 리피터(Repeater), 케이블

- 데이터가 무엇인지, 어떤 에러가 있는지 등에 전혀 신경쓰지않고 전송만 한다.

<br>

### 기능

1. 전기적 신호 규격을 정의함 (전송속도, 신호의 레벨 등)
2. 신호의 인코딩/디코딩
3. 비트 동기
4. 전송매체 규격 (매체 종류, 케이블링, 커넥터 등)
5. 물리적 회선 정리

# 8. TCP/IP 모델

<img src="https://github.com/ryunian/Study/blob/master/image/TCPIP.png?raw=true" width="700px" height="500px">
# 쿠키 (Cookie)

> 쿠키(cookie)란 하이퍼 텍스트의 기록서(HTTP)의 일종으로서 인터넷 사용자가 어떠한 웹사이트를 방문할 경우  
> 그 사이트가 사용하고 있는 서버를 통해 인터넷 사용자의 컴퓨터에 설치되는 작은 기록 정보 파일을 일컫는다.

- 쿠키는 클라이언트 로컬에 저장되며 키와 값(key, value)이 들어있는 작은 데이터 파일이다.

- 쿠키는 서버에서 HTTP Response Header에 Set-Cookie 속성을 이용하여 클라이언트에 쿠키를 제공한다.

- 쿠키에는 이름, 값, 만료 날짜/시간(쿠키 저장기간), 경로 정보 등이 들어있다.

- 쿠키는 클라이언트의 상태 정보를 로컬에 저장했다가 요청(Request)할 때 참조된다.

- 쿠키는 서버측에서 만료 날짜/시간을 지정하여 정해진 시간동안 데이터(상태정보)를 유지할 수 있다.

<br><br>

##### 왜 쓰는가?
- Connectionless 하고 Stateless 한 HTTP 프로토콜을 사용하면서 Server가 Client를 식별할 수 있는 방법이 필요했고 쿠키와 세션을 사용하게 되었다.

<br><br>

### 1.1 목적

- 세션관리 : 서버에 저장해야할 로그인, 장바구니 등 정보 관리
- 트래킹 : 사용자 행동 기록 및 분석
- 개인화 : 사용자 선호, 테마, 추천 등

<br>

### 1.2 Set-Cookie
> Set-Cookie HTTP 응답 헤더는 서버에서 사용자 브라우저에 쿠키를 전송하기 위해 사용됩니다.

**Expires** =\<date\>  
만료일이 되면 쿠키 삭제

<br>

**Max-Age**=\<number\>  
0이나 음수를 지정하면 쿠키 삭제

<br>

**Domain**=\<domain-value\>    
쿠키가 적용되어야 하는 호스트를 지정  
1. 명시 : 명시한 문서 기준 도메인 + 서브도메인 포함  
2. 생략 : 현재 문서 기준 도메인만 적용  

<br>

**Path**=\<path-value\>  
이 경로를 포함한 하위 경로 페이지만 쿠키 접근  
일반적으로 path=/ 루트로 지정

<br>

**Secure**  
쿠키는 http, https를 구분하지 않고 전송하지만,  
Secure를 적용하면 https인 경우에만 전송

<br>

**HttpOnly**  
XSS 공격방지  
자바스크립트에서 접근 불가(document.cookie)  
HTTP 전송에만 사용

<br>

**Samesite**  
쿠키가 cross-site 요청과 함께 전송되지 않았음을 요구하게 만들어,  
cross-site 요청 위조 공격(CSRF)에 대한 보호 기능을 제공한다.

<br>

<img src="https://github.com/ryunian/Study/blob/master/image/Response.png?raw=true" width="800" height="300"/>

<br>

TMI
1P_JAR : Google에서 설정합니다. 이 그룹은 웹사이트 통계와 같은 기타 정보와 선호도를 기억하고 전환율을 추적하기 위해 고유한 ID를 설정합니다

<br><br>

### 1.3 **Cookie**
클라이언트가 서버에서 받은 쿠키를 저장하고, HTTP 요청시 서버로 전달

<img src="https://github.com/ryunian/Study/blob/master/image/Request.png?raw=true" width="600" height="300"/>

<br><br>

### 1.4 종류

- 세션쿠키 (Session Cookie) : 보통 만료시간(Expire date) 설정하고 메모리에만 저장되며 브라우저 종료 시 쿠키를 삭제한다.
- 영속적인 쿠키 (Persistent Cookie) : 장기간 유지되는 쿠키파일로 저장되어 브라우저 종료와 관계없이 사용한다.

<br><br>

### 1.5 단점

- 쿠키에 대한 정보를 매 헤더에 추가하여 보내기 떄문에 상당한 트래픽을 발생시킨다.
- 쿠키는 보안에 대한 문제점이 있다.
    - 그렇기 떄문에 보안에 민감한 데이터(결제정보 등)는 저장하면 안된다.
    - XSS (Cross-Site Script Scripting)

        공격자가 자바스크립트 문을 이용하여 cookie값을 탈취하는 방법

    - 스니핑 (Sniffing)

        스니퍼를 이용해서 네트워크 중간에서 자신이 아닌 남의 패킷을 도청하는 해킹하는 것

    - 공용 PC에서 쿠키값 유출

        사용자가 웹 페이지에 이동하여 사용을 하게 된다면, 원치않아도 쿠키값이 남아있는 문제가 있다.

    - 호스팅 공유문제

        호스팅을 공유하는 사이트를 이용하는 경우, 공유된 사이트중 보안이 취약한 사이트를 찾아 공격을 하면 모든 공유사이트들 역시 공격 당할 수 있는 문제를 가지고 있다.

    - 쿠키의 개인정보 침해 위험

        웹사이트의 무분별한 수집 및 안일한 보안 구축으로 인한 피해